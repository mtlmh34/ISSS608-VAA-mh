---
title: "Take-home Exercise 4"
categories: take-home exercise
description: |
  This take home exercise aims to uncover the impact of COVID-19 as well as the global economic and political dynamic in 2022 on Singapore bi-lateral trade by using various analytical visualisation techniques.
author:
  - name: Liang Minghao
    affiliation: SMU, MITB
    affiliation_url: https://scis.smu.edu.sg/master-it-business
date: "Feb 22 2023"
date modified: "`r Sys.Date()`"
execute: 
  echo: true
  eval: true
  warning: false
preview: 
output:
  html_document:
    self_contained: false
    toc: true
    toc_float: true
    toc_depth: 3
    code_folding: hide
---

# 1. Overview

The COVID-19 pandemic has significantly impacted the global trade and economy since its outbreak in Year 2020. In this study, we will analyse the import and export volume between **Singapore** and **other ASEAN countries, US** as well as **China**.

# 2. Data Processing

The data used for this take-home exercise is extracted from [SingStat](https://www.singstat.gov.sg/find-data/search-by-theme/trade-and-investment/merchandise-trade/latest-data), in excel spreadsheet format.

## 2.1. Loading Libraries

```{r}
pacman::p_load(dplyr, tidyverse, ggplot2, ggthemes,ggHoriPlot, lubridate, readxl, knitr,CGPfunctions)
```

## 2.2. Loading Data

```{r}
import <- read_excel('/Users/minghaooo/mtlmh34/ISSS608-VAA-mh/Data/outputFile.xlsx', sheet='T1',
                     skip = 9, n_max = 120)
export <- read_excel('/Users/minghaooo/mtlmh34/ISSS608-VAA-mh/Data/outputFile.xlsx', sheet='T2',
                     skip = 9, n_max = 120)
```

## 2.3. Data Wrangling

In data wrangling, the following tasks are performed:
 - focus on only trades with ASEAN countries, US and China
 - focus on only data in 2020-2022
 - transpose the data to long table
 - join import and export data
 
```{r}
trade_countries <- c("Brunei Darussalam","Indonesia","Malaysia","Philippines",                        
                     "Thailand","Myanmar","Cambodia","Laos People's Democratic Republic",  
                     "Vietnam, Socialist Republic Of", "Mainland China", "United States")

processing <- function(df){
  df$'Data Series' <- str_replace(df$'Data Series', ' \\(Thousand Dollars\\)', '')
  df <- df %>%
    rename('Country' = 'Data Series') %>%
    filter(Country %in% trade_countries) %>%
    select('Country'|starts_with('2022')|starts_with('2021')|starts_with('2020')) %>%
    pivot_longer(!Country, names_to = 'Month', values_to = 'Thousands')

  return(df)
}

import_by_country <- processing(import)
export_by_country <- processing(export)

# Merge two dataset, sort by country and month ascending
import_export_by_country <- left_join(import_by_country,export_by_country,
                                      by=join_by('Country', 'Month')) %>%
  mutate(Month=substr(ym(Month),1,7)) %>%
  arrange(Country,Month) %>%
  rename('Import' = 'Thousands.x', 'Export' = 'Thousands.y')

import_export_by_country$Total <- import_export_by_country$Import+import_export_by_country$Export

```
 
The dataframe after pre-processing is as follows:
```{r}
kable(head(import_export_by_country), 'pipe')
```

# 3. Visualizations

## 3.1. SlopeGraph


```{r fig.width=9, fig.height=10}
## change to import + export


import_export_by_country$Year <- substr(import_export_by_country$Month,1,4)
import_export_by_country %>%
  group_by(Country, Year) %>%
  summarise(Total=round(sum(Total)/1000/1000,2)) %>%
  mutate(Year = factor(Year)) %>%
  newggslopegraph(Year, Total, Country,
                Title = "Total Trade Volume with ASEAN countries, US and CN (in Billions)",
                SubTitle = "2020 - 2022",
                Caption = "Prepared by: Liang Minghao")
```

```{r}
import_export_by_country
```



## 3.2. Horizon Graph

```{r}
import_export_by_country$difference=import_export_by_country$Import-import_export_by_country$Export
import_export_by_country$Month=ym(import_export_by_country$Month)

deficit_by_country <- import_export_by_country[,c('Country','Month','difference')]
```



```{r fig.width=9}
#horizon graph

deficit_by_country %>%
  ggplot() +
  geom_horizon(aes(x = Month, y = difference), 
               origin = 0,     # set origin = 0 to reflect deficit/surplus by diff. colours
               horizonscale = 6) +
  facet_grid(`Country`~.) +
  # year reference line
  geom_vline(xintercept = as.Date("2021-1-1"), colour = "grey40", linetype = "dashed", size = 0.5)+
  geom_vline(xintercept = as.Date("2022-1-1"), colour = "grey40", linetype = "dashed", size = 0.5)+
  theme_few() +
  scale_fill_hcl(palette = 'RdBu') +
  theme(
    panel.spacing.y=unit(0, "lines"), 
    strip.text.y = element_text(size = 5, angle = 0, hjust = 0),
    legend.position = 'none',
    axis.text.y = element_blank(),
    axis.text.x = element_text(size=7),
    axis.title.y = element_blank(),
    axis.title.x = element_blank(),
    axis.ticks.y = element_blank(),
    panel.border = element_blank(),
    plot.title = element_text(size= 20),
    plot.subtitle = element_text(size= 14))+
    labs(title="Deficit/Surplus of Singapore, 2020-2022",
         subtitle="Blue = Deficit, Red = Surplus")
# total deficit/surplus
```






